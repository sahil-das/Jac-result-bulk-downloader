from weasyprint import HTML
import datetime
import re

def cover_page_html(college_name, start_roll, end_roll):
    logo_url = "https://results.digilocker.gov.in/assets-new/JAC_logo.png"
    return f"""
    <div style="page-break-after: always; 
                display: flex; 
                flex-direction: column; 
                justify-content: center; 
                align-items: center; 
                height: 100vh; 
                font-family: sans-serif;
                padding: 50px;">
        
        <img src="{logo_url}" alt="Logo" style="height:100px; margin-bottom: 30px;"/>

        <h1 style="font-size: 3em; margin-bottom: 0.2em;">JAC Class 10th Exam Results 2025</h1>
        <h2 style="font-weight: normal; margin-top: 0;">Comprehensive Marksheet Report</h2>
        <h3 style="margin-top: 0.5em;">{college_name}</h3>

        <p style="margin-top: 1em; font-size: 1.1em;">
            <strong>Roll Range:</strong> {start_roll} to {end_roll}
        </p>

        <div style="margin-top: 3em; text-align: center;">
            <p style="font-size: 1.2em;">Generated by Sahil Das</p>
            <p style="font-size: 1em; margin-top: 1em;">Date: {datetime.datetime.now().strftime('%B %d, %Y')}</p>
        </div>
    </div>
    """

def top_10_scorers_html(students):
    html = """
    <div style="page-break-after: always; font-family: sans-serif;">
    <h2 style="text-align:center;">Top 10 Scorers</h2>
    <table style="width:100%; border-collapse: collapse;" border="1" cellspacing="0" cellpadding="5">
        <thead style="background-color: #f2f2f2;">
            <tr>
                <th>Rank</th>
                <th>Name</th>
                <th>Roll No.</th>
                <th>Total Marks</th>
                <th>Percentage</th>
                <th>School</th>
            </tr>
        </thead>
        <tbody>
    """

    for rank, student in enumerate(students, start=1):
        name = student.get("name", "N/A")
        roll = student.get("roll_no", "N/A")
        total = student.get("total_marks", 0)
        percentage = round((total / 500) * 100, 2)
        school = student.get("school", "N/A")

        html += f"""
            <tr>
                <td style="text-align:center;">{rank}</td>
                <td>{name}</td>
                <td style="text-align:center;">{roll}</td>
                <td style="text-align:center;">{total}</td>
                <td style="text-align:center;">{percentage}%</td>
                <td>{school}</td>
            </tr>
        """

    html += "</tbody></table></div>"
    return html

def student_result_card_html(student):
    rows = "".join(f"""
        <tr>
            <td style='border: 1px solid black; padding: 5px;'>{s['code']}</td>
            <td style='border: 1px solid black; padding: 5px;'>{s['theory']:03}</td>
            <td style='border: 1px solid black; padding: 5px;'>{s['practical']:03}</td>
            <td style='border: 1px solid black; padding: 5px;'>{s['total']:03}</td>
            <td style='border: 1px solid black; padding: 5px;'>{s['grade']}</td>
            <td style='border: 1px solid black; padding: 5px;'>{s['remarks']}</td>
        </tr>""" for s in student['subjects'])

    return f"""
    <div style='page-break-after: always; width: 100%; max-width: 794px; margin: 0 auto; display: block; font-family: "Times New Roman", Times, serif; color: black;'>
        <div style='text-align: center; margin-top: 20px;'>
            <p style='font-size: 22px; font-weight: 600;'>JHARKHAND ACADEMIC COUNCIL, RANCHI</p>
            <p style='font-size: 18px;'>Results of</p>
            <p style='font-size: 18px;'>Annual Secondary Examination - 2025</p>
        </div>
        <div style='margin: 20px 40px;'>
            <div style='border: 2px solid black; padding: 15px 20px;'>
                <table style='width: 100%; font-size: 14px; margin-bottom: 20px;'>
                    <tr><td style='width: 25%;'>Roll Code</td><td><strong>{student['roll_code']}</strong></td></tr>
                    <tr><td>Roll Number</td><td><strong>{student['roll_no']}</strong></td></tr>
                    <tr><td>Student's Name</td><td><strong>{student['name']}</strong></td></tr>
                    <tr><td>Father's Name</td><td><strong>{student['father']}</strong></td></tr>
                    <tr><td>Mother's Name</td><td><strong>{student['mother']}</strong></td></tr>
                    <tr><td>School Name</td><td><strong>{student['school']}</strong></td></tr>
                </table>
                <table style='width: 100%; border-collapse: collapse; font-size: 14px; border: 1px solid black;'>
                    <thead>
                        <tr>
                            <th style='border: 1px solid black; padding: 5px;'>Subject Code</th>
                            <th style='border: 1px solid black; padding: 5px;'>Theory</th>
                            <th style='border: 1px solid black; padding: 5px;'>Prac./Ass./CCE</th>
                            <th style='border: 1px solid black; padding: 5px;'>Total</th>
                            <th style='border: 1px solid black; padding: 5px;'>Grade</th>
                            <th style='border: 1px solid black; padding: 5px;'>Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                        {rows}
                        <tr>
                            <td style='border: 1px solid black; padding: 5px; font-weight: bold;'>Total Obt. Marks</td>
                            <td colspan='5' style='border: 1px solid black; padding: 5px;'><strong>{student['total_marks']}</strong></td>
                        </tr>
                        <tr>
                            <td style='border: 1px solid black; padding: 5px; font-weight: bold;'>Result</td>
                            <td colspan='5' style='border: 1px solid black; padding: 5px;'><strong>{student['result']}</strong></td>
                        </tr>
                        <tr>
                            <td style='border: 1px solid black; padding: 5px; font-weight: bold;'>Marks Percentage</td>
                            <td colspan='5' style='border: 1px solid black; padding: 5px;'><strong>{student['percentage']}</strong></td>
                        </tr>
                    </tbody>
                </table>
                <div style='font-size: 14px; margin-top: 20px;'>
                    <strong>NOTE :</strong>
                    <ol style='margin: 5px 0 0 20px;'>
                        <li>"#" mark in column remarks indicates swapping between the subjects.</li>
                        <li>Total Obtained Marks, Result & Percentage is out of 500 marks (best 5 subjects).</li>
                    </ol>
                </div>
            </div>
            <div style='margin-top: 25px; font-size: 13px; text-align: justify;'>
                <b>Disclaimer</b>: This marksheet is digitally generated and intended solely for immediate information to the candidate. The Jharkhand Academic Council, Ranchi shall NOT be held responsible for any inadvertent error in the results published online. The original marksheet issued by the Council shall be treated as the authentic and final record for all official purposes.
            </div>
        </div>
    </div>"""

# main() remains unchanged
def main():
    college_name = "ABC High School"
    start_roll = 10001
    end_roll = 10010

    top_scorers = [
        {"name": "Alice Kumar", "roll_no": "10001", "total_marks": 480, "school": "ABC High School"},
        {"name": "Rohit Singh", "roll_no": "10002", "total_marks": 475, "school": "ABC High School"},
        {"name": "Neha Sharma", "roll_no": "10003", "total_marks": 470, "school": "ABC High School"},
        {"name": "Vikas Patel", "roll_no": "10004", "total_marks": 465, "school": "ABC High School"},
        {"name": "Priya Roy", "roll_no": "10005", "total_marks": 460, "school": "ABC High School"},
        {"name": "Amit Joshi", "roll_no": "10006", "total_marks": 455, "school": "ABC High School"},
        {"name": "Sunita Das", "roll_no": "10007", "total_marks": 450, "school": "ABC High School"},
        {"name": "Rajesh Kumar", "roll_no": "10008", "total_marks": 445, "school": "ABC High School"},
        {"name": "Kiran Singh", "roll_no": "10009", "total_marks": 440, "school": "ABC High School"},
        {"name": "Sonal Gupta", "roll_no": "10010", "total_marks": 435, "school": "ABC High School"},
    ]

    students = [
        {
            "roll_code": "11239",
            "roll_no": "0001",
            "name": "AFREEN NISHA",
            "father": "SHAHABUDDIN ANSARI",
            "mother": "JUMERA KHATUN",
            "school": "ST XAVIER'S HIGH SCHOOL BUNDU",
            "subjects": [
                {"code": "HNA", "theory": 68, "practical": 20, "total": 88, "grade": "A+", "remarks": ""},
                {"code": "SNK", "theory": 67, "practical": 20, "total": 87, "grade": "A+", "remarks": "#"},
                {"code": "MTH", "theory": 66, "practical": 20, "total": 86, "grade": "A+", "remarks": ""},
                {"code": "SCI", "theory": 68, "practical": 20, "total": 88, "grade": "A+", "remarks": ""},
                {"code": "SOC", "theory": 70, "practical": 20, "total": 90, "grade": "A+", "remarks": ""},
                {"code": "ENG", "theory": 64, "practical": 20, "total": 84, "grade": "A+", "remarks": "#"},
            ],
            "total_marks": 439,
            "result": "FIRST DIV.",
            "percentage": "87.80%"
        },
        # Add more students here
    ]

    cover_html = cover_page_html(college_name, start_roll, end_roll)
    top10_html = top_10_scorers_html(top_scorers)
    student_html = "".join([student_result_card_html(s) for s in students])

    global_styles = """
    <style>
      @page {
        size: A4;
        margin: 2cm;
        @top-center {
          content: "JAC Class 10th Results 2025";
          font-size: 12px;
          color: #555;
        }
        @bottom-center {
          content: "Page " counter(page);
          font-size: 12px;
          color: #888;
        }
      }
      body {
        font-family: Arial, sans-serif;
      }
      table, th, td {
        border: 1px solid #ddd;
        border-collapse: collapse;
      }
      th, td {
        padding: 8px;
        text-align: left;
      }
      th {
        background-color: #f2f2f2;
      }
    </style>
    """

    full_html = global_styles + cover_html + top10_html + student_html
    safe_college = re.sub(r'\W+', '_', college_name)
    filename = f"JAC_10th_Results_{safe_college}_{start_roll}_to_{end_roll}.pdf"

    print("Generating PDF...")
    HTML(string=full_html).write_pdf(filename)
    print(f"PDF saved as {filename}")

if __name__ == "__main__":
    main()